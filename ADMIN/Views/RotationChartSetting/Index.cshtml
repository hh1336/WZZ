@section Styles{
    <style>
        .Carousel {
            margin: 0 auto;
            width: 70%;
        }

        .cbtn {
            margin-left: 15%;
            margin-bottom: 10px;
        }
    </style>
}

<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
    <ul class="layui-tab-title">
        <li class="layui-this">首页</li>
        <li>茶品种</li>
        <li>茶文化</li>
    </ul>

    <div class="layui-tab-content">

        <div class="layui-tab-item layui-show">
            <button type="button" class="btn btn-success cbtn">添加</button>
            <button type="button" class="btn btn-danger " style="margin-bottom:10px;" onclick="delRotationChart(this)" wzzid="11">删除</button>
            <div id="HomeCarousel" class="carousel slide Carousel" data-ride="carousel">
                <div class="carousel-inner">

                </div>
            </div>
        </div>

        <div class="layui-tab-item">
            <div class="layui-tab-item layui-show">
                <button type="button" class="btn btn-success cbtn">添加</button>
                <button type="button" class="btn btn-danger " style="margin-bottom:10px;" onclick="delRotationChart(this)" wzzid="13">删除</button>
                <div id="TeaTypeCarousel" class="carousel slide Carousel" data-ride="carousel">
                    <div class="carousel-inner item">

                    </div>
                </div>
            </div>
        </div>

        <div class="layui-tab-item">
            <div class="layui-tab-item layui-show">
                <button type="button" class="btn btn-success cbtn">添加</button>
                <button type="button" class="btn btn-danger " style="margin-bottom:10px;" onclick="delRotationChart(this)" wzzid="14">删除</button>
                <div id="StoryCarousel" class="carousel slide Carousel" data-ride="carousel">
                    <div class="carousel-inner item">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>








@section Scripts{
    <script>
        //保存加载过的数据
        var _homelist;
        var _teatypelist;
        var _storylist;

        //加载图片
        function load() {
            var _homeDom = $("#HomeCarousel");
            var _teaTypeDom = $("#TeaTypeCarousel");
            var _storyDom = $("#StoryCarousel");
            $.post("/RotationChartSetting/GetList", {}, function (result) {
                //全局保存加载过的数据
                _homelist = result.homeRotationChart;
                _teatypelist = result.teaTypeRotationChart;
                _storylist = result.storyRotationChart;
                var active = "";//记录是否为第一条，是则加上对应的类
                var domid = `HomeCarousel`;//记录domid用于控制dom改变
                var imgdiv = ``;//记录轮播图图片的结构
                var li = ``;//记录圆点结构
                var ol = ``;//组装圆点结构
                var carousel = ``;//组装左右切换按钮
                for (var i = 0; i < result.homeRotationChart.length; i++) {
                    if (i == 0) {
                        active = "active";
                    } else {
                        active = "";
                    }
                    li += `<li data-target="#` + domid + `" data-slide-to="` + i + `" class="` + active + `" href="#` + domid + `"></li>`;
                    imgdiv += `<div class="item ` + active + `">
                                            <img src="`+ result.homeRotationChart[i].imgurl + `" width="100%" height="100%" data-id="` + result.homeRotationChart[i].id + `" wzzid="` + result.homeRotationChart[i].wzzModelId + `" arcid="` + result.homeRotationChart[i].articleId + `">
                                            <div class="carousel-caption">
                                                `+ result.homeRotationChart[i].title + `
                                            </div>
                                        </div>`;
                }
                carousel = `<a class="left carousel-control" href="#` + domid + `" role="button" data-slide="prev">
                                                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                                                <span class="sr-only">Previous</span>
                                            </a>
                                            <a class="right carousel-control" href="#`+ domid + `" role="button" data-slide="next">
                                                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                                                <span class="sr-only">Next</span>
                                            </a>`;
                ol = `<ol class="carousel-indicators">` + li + `</ol>`;
                _homeDom.children(".carousel-inner").html(ol);
                _homeDom.children(".carousel-inner").append(imgdiv);
                _homeDom.children(".carousel-inner").append(carousel);

                //清空结构重新组装下一个选项卡
                domid = "StoryCarousel";
                imgdiv = ``;
                li = ``;
                ol = ``;
                carousel = ``;
                for (var i = 0; i < result.storyRotationChart.length; i++) {
                    if (i == 0) {
                        active = "active";
                    } else {
                        active = "";
                    }
                    li += `<li data-target="#` + domid + `" data-slide-to="` + i + `" class="` + active + `"></li>`;
                    imgdiv += `<div class="item ` + active + `">
                                            <img src="`+ result.storyRotationChart[i].imgurl + `" width="100%" height="100%" data-id="` + result.storyRotationChart[i].id + `" wzzid="` + result.storyRotationChart[i].wzzModelId + `" arcid="` + result.storyRotationChart[i].articleId + `">
                                            <div class="carousel-caption">
                                                `+ result.storyRotationChart[i].title + `
                                            </div>
                                        </div>`;
                }
                carousel = `<a class="left carousel-control" href="#` + domid + `" role="button" data-slide="prev">
                                                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                                                <span class="sr-only">Previous</span>
                                            </a>
                                            <a class="right carousel-control" href="#`+ domid + `" role="button" data-slide="next">
                                                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                                                <span class="sr-only">Next</span>
                                            </a>`;
                ol = `<ol class="carousel-indicators">` + li + `</ol>`;
                _storyDom.children(".carousel-inner").html(ol);
                _storyDom.children(".carousel-inner").append(imgdiv);
                _storyDom.children(".carousel-inner").append(carousel);

                //清空结构重新组装下一个选项卡
                domid = "TeaTypeCarousel";
                imgdiv = ``;
                li = ``;
                ol = ``;
                carousel = ``;
                for (var i = 0; i < result.teaTypeRotationChart.length; i++) {
                    if (i == 0) {
                        active = "active";
                    } else {
                        active = "";
                    }
                    li += `<li data-target="#` + domid + `" data-slide-to="` + i + `" class="` + active + `"></li>`;
                    imgdiv += `<div class="item ` + active + `">
                                            <img src="`+ result.teaTypeRotationChart[i].imgurl + `" width="100%" height="100%" data-id="` + result.teaTypeRotationChart[i].id + `" wzzid="` + result.teaTypeRotationChart[i].wzzModelId + `" arcid="` + result.teaTypeRotationChart[i].articleId + `">
                                            <div class="carousel-caption">
                                                `+ result.teaTypeRotationChart[i].title + `
                                            </div>
                                        </div>`;
                }
                carousel = `<a class="left carousel-control" href="#` + domid + `" role="button" data-slide="prev">
                                                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                                                <span class="sr-only">Previous</span>
                                            </a>
                                            <a class="right carousel-control" href="#`+ domid + `" role="button" data-slide="next">
                                                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                                                <span class="sr-only">Next</span>
                                            </a>`;
                ol = `<ol class="carousel-indicators">` + li + `</ol>`;
                _teaTypeDom.children(".carousel-inner").html(ol);
                _teaTypeDom.children(".carousel-inner").append(imgdiv);
                _teaTypeDom.children(".carousel-inner").append(carousel);

            })
        }

        //添加轮播图
        function addRotationChart(id) {
            var app = new appModal({
                title: "添加轮播图",
                url: "/RotationChartSetting/AddOrEdit",
                data: { WZZModelId: id },
                callback: function (result) {
                    console.log(result)
                },
                yes: function (e) {
                    e.preventDefault();
                    console.log(123);
                }
            });
            app.open();
        }

        //当用户点击添加时
        $(document).on("click", ".cbtn", function (e) {
            e.preventDefault();
            var wzzid = $(this).next().attr("wzzid");
            addRotationChart(wzzid);
        })

        $(function () {
            load();
        })
    </script>
}